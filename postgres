#!/bin/bash
# This script helps doing with postgres docker image.
# More informations: https://hub.docker.com/_/postgres/

source ./config

daemon() {
        docker run \
                -d \
                --name $POSTGRES_CONTAINER \
                -e "POSTGRES_USER=$POSTGRES_USERNAME" \
                -e "POSTGRES_PASSWORD=$POSTGRES_PASSWORD" \
                -e "PGDATA=/var/lib/postgresql/data/pgdata" \
                -v $POSTGRES_DATA:/var/lib/postgresql/data \
                $POSTGRES_IMAGE
}

client() {
        docker run \
                -ti --rm \
                --link $POSTGRES_CONTAINER:postgres \
                $POSTGRES_IMAGE \
                sh -c 'exec psql -h "$POSTGRES_PORT_5432_TCP_ADDR" -p "$POSTGRES_PORT_5432_TCP_PORT" -U '"$POSTGRES_USERNAME"
}

[ -z $1 ] && echo Possible commands: daemon - client && exit 1
[ $1 = daemon ] && { shift; daemon $*; exit $?; }
[ $1 = client ] && { shift; client $*; exit $?; }
echo Unknown command && exit 1
