#!/bin/bash
# This script helps doing with postgres docker image.
# More informations: https://hub.docker.com/_/postgres/

server() {
        docker run \
                -d \
                --name $PG_CONTAINER \
                -e "POSTGRES_USER=$PG_USERNAME" \
                -e "POSTGRES_PASSWORD=$PG_PASSWORD" \
                -e "PGDATA=/var/lib/postgresql/data/pgdata" \
                -v $PG_VOLUME:/var/lib/postgresql/data \
                $PG_IMAGE
}

client() {
        docker run \
                -ti --rm \
                --link $PG_CONTAINER:postgres \
                $PG_IMAGE \
                sh -c 'exec psql -h "$POSTGRES_PORT_5432_TCP_ADDR" -p "$POSTGRES_PORT_5432_TCP_PORT" -U '"$PG_USERNAME"
}

usage() {
        echo
        echo Possible commands
        echo
        echo "  server : run a postgres server (docker container)"
        echo "  client : run a postgres client (docker container)"
        echo
}

main() {
        local script_path; script_path=`readlink -f $0`
        local script_dir; script_dir=`dirname $script_path`
        source $script_dir/.env
        #
        [ -z $1 ] && usage && return 1
        local cmd; cmd=$1; shift
        #
        [ $cmd = server ] && { server $*; return $?; }
        [ $cmd = client ] && { client $*; return $?; }
        usage && return 1
}

main $*
